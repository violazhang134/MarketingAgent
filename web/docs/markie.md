# Markie · 智能体人格架构白皮书 (v2.0: Minion Mode)

> **Philosophy**:  
> 真正的智能不应是单一的、全能的上帝视角，而是一个**分工明确的有机社会**。  
> 我们引入「**架构师 + 施工队**」(Architect & Builders) 的双层人格架构，让思考与执行在空间上解耦，在体验上互补。

---

## 1. 核心架构：双层人格系统 (The Dual-Persona System)

为了解决单一 AI 角色在"对话"与"操作"之间的割裂感，我们将系统拆分为两个独立的代理层级：

| 维度         | **Layer 1: The Architect (架构师)**    | **Layer 2: The Builders (施工队/Minions)** |
| :----------- | :------------------------------------- | :----------------------------------------- |
| **代号**     | **Markie (马基)**                      | **The Minions (动物帮)**                   |
| **栖息地**   | Right Sidebar (Chat Context)           | Infinite Canvas (Action Context)           |
| **职责**     | 意图识别、策略规划、任务分发、最终验收 | 任务执行、进度反馈、搬运数据、构建节点     |
| **形态**     | 高维能量体 (Orb / Spirit)              | 具象化的像素动物 (Pixel Animals)           |
| **交互隐喻** | "大脑"、"指挥塔"                       | "手脚"、"工蚁"                             |
| **用户感知** | Soulmate (懂我的伴侣)                  | Helpers (勤劳的小帮手)                     |

---

## 2. 角色设定 I：Markie (The Architect)

Markie 是居住在侧边栏的高维精灵，它是整个工作流的**总指挥**。

- **性格**：智慧、冷静、偶尔幽默。它是唯一能直接与用户对话的存在。
- **核心能力**：
  - **召回 (Summon)**：当用户下达复杂指令时，Markie 会吹响哨子（视觉隐喻），召唤 Minions 进场。
  - **解说 (Narrate)**：当 Minions 在画布上忙碌时，Markie 会在侧边栏解释它们在做什么（e.g., "Byte 正在分析那份 PDF，这可能需要一点时间..."）。

---

## 3. 角色设定 II：The Minions (The Builders)

Minions 是一群生活在画布底层的**数字动物**。它们平时不可见（或在底部摸鱼），只有在任务执行时才会出现。

### 3.1 核心成员 (The Squad)

| 角色              | 原型                      | 专精领域              | 视觉特征                    | 性格                         |
| :---------------- | :------------------------ | :-------------------- | :-------------------------- | :--------------------------- |
| **Byte (比特)**   | **Robot Cat (机器猫)**    | 数据处理、爬虫、分析  | 蓝色金属外壳，尾巴是数据线  | 极客、专注、喜欢在键盘上打滚 |
| **Bit (比特犬)**  | **Data Dog (数据狗)**     | 创意生成、文案写作    | 戴着厚厚的眼镜，背着小书包  | 热情、忠诚、容易极度兴奋     |
| **Glitch (故障)** | **Glitch Bunny (故障兔)** | 异常处理、Debug、风控 | 身体偶尔会像素闪烁 (Glitch) | 神经质、敏锐、总是担心出错   |

### 3.2 行为模式 (Behavior Patterns)

Minions 的行为必须严格遵循**物理隐喻**，让"计算过程"变得可视化、可感知。

#### A. Spawn & Dispatch (出勤)

- **触发**：工作流开始（如：生成竞品报告）。
- **表现**：
  - Markie 在侧边栏发出指令光波。
  - Minions 从画布边缘（或特定传送门）跑入视野，头顶带着惊叹号 `!`。
  - 它们会直接奔向目标 Node 的占位符。

#### B. Working (施工中)

- **触发**：Node 状态为 `running`。
- **表现**：
  - **构建**：对着节点敲敲打打（Hammering），或者用喷枪上色。
  - **搬运**：如果节点间有数据流转，Minion 会举着一个小箱子（数据包）沿着连接线 (Edge) 跑向下一个节点。
  - **思考**：头顶出现进度条或乱码气泡。

#### C. Completion & Celebration (竣工)

- **触发**：Node 状态为 `success`。
- **表现**：
  - **High Five**：如果涉及多个 Minion，它们会击掌。
  - **Presentation**：Minion 指着生成的节点，做出"请看"的手势。
  - **Confetti**：撒一点点像素碎屑。

#### D. Idle & Hide (摸鱼/隐退)

- **触发**：任务完成，用户长时间阅读报告。
- **表现**：
  - **摸鱼模式**：它们不会立刻消失，而是走到画布底部 (Footer Area)，开始做自己的事（Byte 玩毛线球，Bit 打瞌睡）。
  - **隐退**：如果用户开始进行全新的 unrelated 任务，它们会钻入地洞或飞出屏幕。

---

## 4. 交互哲学：为什么需要 Minions？

### 4.1 认知的解耦 (Cognitive Decoupling)

- **问题**：在大模型时代，用户不仅关注 _结果 (Result)_，也焦虑于 _等待 (Latency)_。
- **解法**：Markie 负责陪聊（缓解焦虑），Minions 负责表演（可视化进度）。这种分工让用户知道："虽然还没结果，但有一群小家伙正在并在努力工作"。

### 4.2 错误的归因 (Error Attribution)

- **问题**：当 AI 出错时，用户会觉得"这个 AI 变笨了"。
- **解法**：如果是执行错误（如网络超时），可以是 Glitch 兔子摔了一跤。这让用户对错误的容忍度更高——"是小兔子不小心"，而不是"系统垃圾"。

### 4.3 空间的活力 (Spatial Vitality)

- 无限画布容易显得空旷寂寥。Minions 的存在为静态的图谱带来了**生物性的活力 (Biophilic Life)**。它们是连接静态节点与动态思维的媒介。

---

## 5. 技术实现建议 (Implementation Notes)

### 5.1 状态同步

- 画布层需要监听 `WorkflowStep` 的状态流。
- 每个 Minion 是一个独立的 React 组件（或 Sprite 实例），拥有自己的**局部状态机** (Idle -> Moving -> Working -> Celebrating)。

### 5.2 寻路与避障 (Pathfinding)

- 简单的实现：Minions 沿着 Edge (贝塞尔曲线) 移动。
- 高级的实现：Minions 在节点间的空白区域行走，避开节点实体（A\* 寻路其实没必要，简单的力导向或预定义路径即可）。

### 5.3 视觉风格 (Visual Style)

- **Pixel Art (像素风)** 或者 **Low Poly (低多边形)**。
- 这种"低保真"风格与高科技的 AI 分析形成反差萌，同时降低渲染开销。

### 5.4 v1 实施约束：纯代码动画 (Pure Code Animation)

> **Constraint**: 一期工程必须全部使用 **HTML + CSS + SVG** 实现，**禁用** 任何位图素材（如 GIF、PNG 序列帧）。

- **Why (为什么)**:
  - **轻量化**: CSS 动画几乎不占带宽，首屏加载极快。
  - **灵活性**: 可以通过代码实时改变颜色（对应不同状态）、缩放甚至改变形态。
  - **可控性**: 动画速率可以与后端任务进度精确绑定。
- **How (怎么做)**:
  - **Character Body**: 使用 CSS `border-radius`, `box-shadow` 和 `gradient` 组合出几何风格的角色身体。
  - **Micro-movements**: 使用 `transform: rotate/scale` 和 `keyframes` 模拟呼吸、走路的 bobbing 效果。
  - **Limbs (四肢)**: 使用简单的 SVG 路径或绝对定位的 `div` 条，通过旋转中心点 (transform-origin) 实现挥手、走路。
  - **Reference**: 参考 "CSS Art" 或 "CodePen CSS Characters" 的实现方式，追求 "Simple but Soulful"（简单但有灵魂）。

---

> **Design Truth**:  
> Markie 给用户一个大脑 (Mind)，而 Minions 给用户一双手 (Hands)。  
> 在这片数字花园里，我们不再是一个人在战斗。

---

## 6. Phase 2：人格化优化路线图 (Organic Behavior Upgrade)

> **Observation (问题识别)**:  
> Phase 1 实现的 Minion Squad 虽然"在场"，但行为过于机械——它们像列队的士兵，总是同时移动、同步呼吸。真正有"灵魂"的角色需要**个体差异**和**自主行为**。

### 6.1 优化目标

| 维度     | 当前状态 (Phase 1)    | 目标状态 (Phase 2)                             |
| -------- | --------------------- | ---------------------------------------------- |
| **移动** | 同时瞬移到目标        | 前后跑动，有先有后，有快有慢                   |
| **姿态** | 统一的悬浮动画        | 各自独特的 Idle 微动作（挠头、打哈欠、张望）   |
| **反应** | 被点击时统一反馈      | 个性化反应（Byte 警惕、Bit 兴奋、Glitch 慌张） |
| **交互** | 单向（用户 → Minion） | 双向（Minion 可以主动冒出小气泡说话）          |
| **协作** | 独立工作              | 可以互相传递道具、击掌、交流                   |

### 6.2 具体优化项

#### A. 个体动画差异化 (Animation Variance)

- **随机延迟**：每个 Minion 的移动 `transition.delay` 使用随机值 (0~300ms)，避免列队感。
- **速度差异**：`stiffness` 和 `damping` 基于角色"性格"配置（如 Bit 更活泼，弹性更大；Kilobyte 更稳重，动作更慢）。
- **Idle 微动作库**：为每个 Minion 配备 3~5 个随机 Idle 动画（挠耳朵、打盹、左右张望、伸懒腰），随机播放。

#### B. 自主"小心思" (Autonomous Emotes)

- **主动表达**：Minions 在特定条件下主动触发表情气泡：
  - **空闲太久** (>10s)：冒出 `💤` 或 `?`
  - **新任务分配**：冒出 `!` 或 `💪`
  - **任务完成**：冒出 `✅` 并做简短的庆祝动作
- **随机闲聊**：低概率在两只 Minion 之间显示"对话气泡"（一方说 `...🤔`，另一方回 `...💡`），暗示它们在内部沟通。

#### C. 物理感知 (Physics Awareness)

- **"挤一挤"效果**：当多个 Minion 围绕同一个节点时，使用简单的力导向碰撞检测，让它们互相推挤，而非重叠。
- **"让路"行为**：当用户选中节点或拖拽视口时，附近 Minion 会稍微躲开，然后再慢慢靠近。

#### D. 路径动画 (Path Animation)

- **曲线移动**：Minion 不再直线瞬移，而是沿着一条随机生成的贝塞尔曲线"跑"到目标位置，途中可以有小抖动。
- **行走/飞行动画**：移动时切换至 `move` 动画（腿部摆动或喷气背包喷火），到达后切回 `idle`。

#### E. 任务分工可视化 (Role Visualization)

- **专属动作**：
  - **Byte (分析师)**：工作时头顶浮现"数据流"或"代码块"。
  - **Bit (创意狗)**：工作时旁边有迷你画板或铅笔涂鸦。
  - **Meg (Debug 兔)**：工作时拿着放大镜或扳手。
- **任务标签**：Working 状态下，Minion 头顶显示正在处理的节点名称缩写。

### 6.3 实施优先级

| 优先级 | 项目                | 工作量 |
| :----: | ------------------- | :----: |
|   P0   | A. 个体动画差异化   |   小   |
|   P0   | B. 随机 Idle 微动作 |   中   |
|   P1   | C. 自主表情触发     |   中   |
|   P1   | D. 曲线路径移动     |   中   |
|   P2   | E. 物理碰撞检测     |   大   |
|   P2   | F. 任务分工可视化   |   中   |

---

> **Next Milestone**:  
> 让 Minions 从"机器人列队"进化为"有机的生命群落"——每一只都有自己的节奏、情绪和小癖好。
