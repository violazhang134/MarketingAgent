# AI 助手右侧边栏 + 无限画布集成 PRD（Draft）

> 产品：MiniGame Marketing Agent  
> 模块：AI 调研助手（右侧边栏 + 无限画布）  
> 版本：v0.1 Draft  
> 作者：PM  
> 状态：草稿，待与设计 / 前端 / 后端评审

---

## 1. 功能概述

### 1.1 背景

- 当前产品已具备「竞品调研 → 策略洞察 → 发布包生成 → 实验 & Next Best Action」的完整闭环：  
  - Agent 在后台“完成了很多事”，但用户可修改程度低。  
  需要给Agent人格化的灵魂来面向更多小白用户
- 行业趋势：越来越多增长团队希望将「AI 调研过程」沉淀为可复用知识资产（可视化脑图 / 画布），便于协作和复盘。
- **核心原则**：
  1. **功能融合**：不是重写一套新的功能，而是把目前已经有的功能在 Agent 模式中融合到无限画布上展示。
  2. **叙事降级（Narrative Downgrade）**：不将 AI 包装为全知全能的“专家”或“副驾驶”，而是设定为“创意精灵（Sprite）”。
     - **目的**：通过“非人化”和“童话化”的设定，降低用户对 AI 准确性的过度预期。当 AI 出现幻觉或错误时，用户会认为是精灵“调皮了”或“发呆了”，而非产品缺陷，从而提升容错率和用户留存。

### 1.2 目标

- 在现有 Marketing Agent 中引入「右侧 AI 助手侧边栏 + 无限画布」，实现：
  1. **实时可视化调研过程**：将 AI 的思考路径投射到画布上。  
  2. **轻量协作空间**：用户可以在画布上补充节点、标注、上传素材。  
  3. **人格化叙事**：通过「Markie」作为“创意精灵”的角色设定，建立独特的交互世界观（池塘、礼物、通灵）。
  4. **功能融合与迁移**：将现有散落的“一键分析”类功能按钮，平滑迁移至右侧 AI 助手的“快捷指令”中。



## 2. 核心功能需求

### 2.1 右侧边栏 AI 助手模块

#### 2.1.1 结构与尺寸

- 布局位置：  
  - 固定在页面右侧，覆盖在主内容之上（z-index 高于主内容，低于全局模态）。  
- 宽度：  
  - 默认宽度 **320px**。  
  - 支持 3 种状态：  
    - 折叠：宽度 56px，仅显示助手头像 + 主 CTA 按钮。  
    - 半展开：宽度 320px，显示对话 + 快捷指令。  
    - 全展开（可选后续版本）：宽度 420px，用于复杂调研流程。

#### 2.1.2 显示与触发模式

- 显示模式：
  - 悬浮模式：悬浮在右侧，跟随当前页面（首页 / Agent / Launch / Feed）切换。  
  - 常驻模式：在指定关键页（如 /launch/report、/agent）默认展开。  
  - 工作模式：当用户在对话区发出「调研 / 分析 / 生成」类指令并被接受后，自动进入「画布 + 边栏」组合视图，右侧边栏与中央画布同时可见。  
- 触发方式：
  - 右下角全局入口（圆形按钮，展示 Markie 头像）。  
  - 键盘快捷键（例如 `Cmd + Shift + M`），用于高级用户快速唤起 /隐藏。

#### 2.1.3 功能分区

1. 对话区
   - 展示形式：上下排列的对话气泡（用户 / Markie）。  
   - 支持能力：  
     - 自由问答（关于竞品、市场、素材策略的自然语言问答）。  
     - 引导式提问（由系统给出的「下一步问什么」建议）。  
   - 与画布联动：  
     - 当 Markie 完成一个「调研子任务」（如“竞品广告抓取”、“评论情感分析”）时，会在画布上自动生成对应节点。

2. 快捷指令区
   - 位置：对话区下方，固定高度区域。  
   - 形式：标签 / 按钮（Chip）+ 图标。  
   - **功能定义**：此处不是新增功能的堆砌，而是现有功能入口的聚合。将目前页面上分散的“一键竞品分析”等核心按钮，作为快捷指令放入此处。
   - **v0.1 范围**：仅上线 1–2 个代表性快捷指令，用于演示「Agent 能力 → 画布节点」的闭环。其他指令作为后续版本候选，不在本期实现范围内。
   - 预置指令示例（设计稿可以预留，但实现仅做子集）：  
     - 「一键竞品分析」（原功能复用，v0.1 必做）  
     - 「整理出 3 个关键用户细分」（可选，后续版本）  
     - 「把当前画布转成汇报大纲」（可选，后续版本）  
   - 交互：点击后自动填充一次对话请求，并在对话区展示。

3. 动画展示区
   - 位置：侧边栏顶部区域，与 Markie 头像区域叠加。  
   - 功能：  
     - 展示当前任务类型（调研 / 分析 / 生成）对应的加载动画。  
     - 展示 Markie 表情状态（等待 / 思考 / 成功 / 错误等）。

### 2.2 无限画布集成

#### 2.2.1 画布入口与布局

- 入口形式：
  - 主界面顶部增加「Research Canvas」入口（新 Tab 或按钮），可直接进入画布工作视图。  
  - 在 Launch / Report 等页面中，右侧边栏顶部提供「进入画布模式」按钮。  
  - 在 Markie 对话区中，当用户首次发起「调研 / 分析 / 生成」类任务时，系统自动打开画布并保持右侧边栏同时展示。  
- 显示方式：
  - 默认模式：在当前页面中，将中央主内容区域切换为 Research Canvas，同时右侧固定显示 Markie 边栏（320px），形成「画布工作区 + Chatbox」并行视图。  
  - 全屏模式（后续版本）：提供独立 `/canvas/:id` 路由，以全屏形式查看同一画布。

#### 2.2.2 节点自动生成规则

- 触发规则：
  - 当 Markie 在对话中完成一个「结构化任务」时，自动生成节点：  
    - 示例任务：  
      - `analyzeCompetitor()` → 生成「竞品广告策略」节点。  
      - `analyzeComments()` → 生成「用户评论洞察」节点。  
      - `generateCreativeAssets()` → 生成「创意生成方案」节点。  
- 节点内容映射：
  - 文本节点：  
    - 标题：任务名称（如「竞品广告策略」）。  
    - 内容：简要摘要（来自 Engine 返回的 summary / strategy）。  
  - 引用节点：  
    - 指向系统内某页面或报告（如 Launch Pack、Insights 报告）。  
  - 图表节点：  
    - 以简单图形展示情感分布 / 实验结果（初期可以是占位图 + 文本，后续再图形化）。

#### 2.2.3 节点类型

- 文本节点：  
  - 标准文本块，支持标题 / 正文两级样式。  
- 图表节点：  
  - 初期使用简单的「图表占位」样式 + 关键指标文字信息。  
  - 典型场景：评论情感分布、实验对照结果。  
- 引用节点：  
  - 包含跳转链接（指向 app 内对应页，比如 /launch/pack?campaignId=xxx）。  
  - 显示链接标题 + 简短描述。  
- 多媒体节点：  
  - 支持上传或引用图片 / 视频（例如广告截图、录屏封面）。  
  - 初期仅支持图片 + 简要备注。

#### 2.2.4 布局策略

- 自动网格布局：
  - 默认采用自上而下、自左向右的网格布局，保证节点之间间距统一，可读性强。  
  - 同一「调研阶段」的节点对齐在同一列 / 行。  
- **v0.1 范围（MVP）**：
  - 仅实现「节点卡片栅格展示」，不提供拖拽、缩放、连线等高级交互能力。  
  - 重点是演示「Markie 快捷指令 → 调研引擎 → 画布节点」的端到端闭环，而不是一次性把无限画布能力做满。  
- 后续版本设想：
  - 手动调整：用户可以拖拽单个节点进行微调位置，拖拽结束时自动吸附到最近网格点（Snap to Grid）。  
  - 自动对齐与连线：节点之间以简单箭头 / 连线展示「任务顺序」，如「竞品调研」→「评论分析」→「创意生成」→「实验配置」。


---

## 3. 人格化设计规范（叙事降级策略）

### 3.1 创意精灵角色设定（Markie）

- **身份重构**：
  - **不是**：穿西装的专家、冷冰冰的机器人助手。
  - **而是**：**Markie (创意精灵)** —— 一个生活在营销数据流中的灵体生物。
  - **隐喻**：它像是一个热心但偶尔会犯迷糊的小精灵。它拥有强大的计算能力，但需要人类的引导（Rituals）才能发挥作用。
- **外观设定**：
  - 2D 扁平化风格，但带有“生物感”（如触角、尾巴或光晕）。
  - **关键特征**：没有固定的人类五官，通过形状变化和“眼神”（光点）表达情绪。
  - **配饰系统**：根据任务不同戴不同的帽子（调研时戴侦探帽，生成时戴画家帽）。
- **性格标签**：
  - **热心 (Enthusiastic)**：总是渴望帮忙，收到任务会开心地转圈。
  - **古灵精怪 (Quirky)**：思维跳跃，偶尔会给出意想不到的创意（Good Hallucination）。
  - **非人感 (Ethereal)**：遇到难题时会进行“通灵”，而不是“计算”。

#### 3.1.1 v0.1 人格化实现范围（MVP）

- 表现形式：
  - 使用轻量文本表情（如 `(^_^)`、`(o_o)` 等）+ 渐变背景块，作为 Markie 的头像区域，不引入复杂插画资源。  
  - 通过徽章文案 + 头像表情 + 简单动效（如轻微 pulse）表达不同状态，而不是完整的 Lottie 动画系统。
- 状态覆盖：
  - 与 3.2.1 中定义的 5 种核心状态一一对应：Idle / Listening / Channeling / Mischief / Magic。  
  - 每种状态有：
    - 一条状态标签文案（如「通灵中」「有点调皮」）。
    - 一条人格化的状态子文案（如「正在连上线营销宇宙」「这次施法失败了，稍后再试试」）。
    - 对应的文本表情与背景渐变。
- 不在 v0.1 内的内容：
  - 复杂形象插画、多套换装（帽子）、完整状态机驱动的高帧率动画。  
  - Markie 在画布中“飞过去种节点”的路径动画，仅保留为文案层隐喻，不做真实动画实现。

### 3.2 动画系统与状态隐喻

#### 3.2.1 核心状态（State Metaphors）

1. **Idle (发呆/观察)**：
   - 漂浮在光标或边栏附近，偶尔抓抓头，或者好奇地看着用户的鼠标操作。
2. **Listening (接收礼物)**：
   - 当用户输入或拖入文件时，Markie 表现出“收到礼物”的开心状态，双手接住信息。
3. **Channeling / Warging (通灵/连接宇宙)**：
   - **替代原“Loading/Thinking”状态**。
   - 当调用外部工具或进行复杂分析时，Markie 的眼睛翻白（参考权游 Warging）或全身发光，表示它正在连接“营销宇宙”的知识库。
   - **设计意图**：解释延迟和卡顿——这是复杂的“施法过程”。
4. **Mischief / Confused (调皮/迷糊)**：
   - **替代原“Error”状态**。
   - 任务失败或不知道怎么做时，Markie 会挠头、弄乱画布上的线条，或者躲进云层里。
   - **用户心理**：“哎呀它又调皮了”，而不是“系统崩了”。
5. **Success / Magic (施法成功)**：
   - 生成结果时，撒下“魔法粉末”（粒子特效），节点从光芒中生长出来。

#### 3.2.2 v0.1 动画实现范围（MVP）

- 优先采用 Tailwind/Framer Motion 的轻量动效：
  - 头像区域在 Channeling / Magic 状态下使用缓慢的 `pulse` / 亮度变化，作为“通灵中 / 施法成功”的视觉暗示。  
  - 边栏整体采用简单的滑入滑出过渡，不实现复杂的路径动画。
- 具体取舍：
  - 不实现粒子特效、路径性飞行、节点生长等重型动画，仅用文案 + 轻量动效承载隐喻。  
  - 将完整动画系统保留为后续版本目标，以免在 v0.1 阶段把工程量压到视觉动效上，影响主链路（调研 → 画布节点）的交付。

#### 3.2.2 微交互

- **鼠标悬停**：Markie 会害羞地躲闪一下，或者凑近屏幕看你在干嘛。
- **节点生成**：不是机械地弹出，而是由 Markie 飞过去“种”下的。

---

## 4. 技术实现（草案）

### 4.1 接口对接

#### 4.1.1 AI 服务 API 对接

- 现状：前端使用本地 Engines（analysis-engine / comment-analyzer / creative-engine）进行 mock 计算。  
- 目标：为未来接入真实 LLM / 后端服务预留统一接口层。  
- 设计：
  - 定义统一的 `AiAssistantService`（前端 Service 层）：  
    - `sendMessage(sessionId, message, context): Promise<AssistantReply>`  
    - `runResearchFlow(config): Promise<ResearchFlowResult>`  
  - 当前版本：Service 内部调用现有 Engines，并构造接近真实 API 的响应格式。  
  - 后续版本：将 Service 内部实现替换为真实 HTTP/WebSocket 调用即可。

#### 4.1.2 画布数据同步机制

- 数据模型：
  - Canvas： `{ id, title, createdAt, updatedAt }`  
  - Node： `{ id, canvasId, type, position, content, sourceTaskId }`  
  - Edge： `{ id, fromNodeId, toNodeId, label? }`  
- 同步策略（v0.1 前端本地版本）：  
  - 将 Canvas 状态存储在前端 Store（Zustand）+ localStorage。  
  - 每次节点新增 / 移动时，更新本地状态并触发 UI 重渲染。  
- 同步策略（后续多端版本设想）：  
  - 引入轻量后端服务，支持：  
    - `GET /canvas/:id`  
    - `POST /canvas/:id/nodes`  
    - `PATCH /canvas/:id/nodes/:nodeId`  
  - 多端同步延迟目标 < 500ms，可通过长轮询或 WebSocket 实现。

#### 4.1.3 动画资源加载策略

- 资源形式：  
  - 第一阶段使用轻量 SVG / CSS 动画（减少体积与依赖）。  
  - 如需更复杂动画，可引入 Lottie JSON，但需按需加载。  
- 加载策略：
  - 首次打开 Markie 时，懒加载动画资源。  
  - 不同任务类型的动画按需加载，避免一次性加载全部动画集。  
- 性能要求：  
  - 首次加载主动画资源时间 < 300ms（在典型网络环境下）。

### 4.2 性能与延迟要求

- 动画加载时间：  
  - 目标 < 300ms（首屏 Markie 出现时）。  
- 画布节点渲染：  
  - 单次批量插入 ≤ 20 个节点时，渲染延迟 < 150ms。  
  - 需要基于虚拟列表 / 局部重绘，避免全量重排。  
- 多端同步延迟（后续）：  
  - 目标 < 500ms，从一端创建节点到另一端看到更新的时间。

---

## 5. 测试用例（高层级）

### 5.1 功能测试

1. 边栏与画布双向交互
   - 用例：在边栏发起「竞品调研」指令 → 检查画布上是否自动生成相应节点。  
   - 用例：在画布上选中一个节点 → 边栏显示对应的任务上下文与历史对话。  

2. 高负载场景下的动画流畅度
   - 用例：模拟连续触发 10 次调研任务（连续节点生成），观察 Markie 动画是否卡顿。  
   - 预期：动画帧率保持在可接受范围，无明显掉帧。

3. 多设备适配
   - 桌面端：宽屏 / 窄屏下边栏宽度与内容是否适配。  
   - 平板 / 小屏：边栏是否自动进入覆盖模式（覆盖主内容，而非挤压主内容）。

### 5.2 用户体验测试

1. 5 种典型用户路径
   - Path 1：新用户首次进入竞品调研 → 打开边栏 → 一键生成调研画布。  
   - Path 2：老用户从 Feed 点击「Next Best Action」，跳转时自动打开 Markie，展示对应画布。  
   - Path 3：团队成员使用画布进行复盘，仅浏览节点与简要说明。  
   - Path 4：重度用户通过快捷指令快速构建多个调研路径。  
   - Path 5：移动端 / 小屏用户在有限空间内查看画布与边栏的切换体验。

2. 认知负荷评估
   - 指标：用户是否能在 1 分钟内理解「画布节点代表什么」、「线条含义」等关键概念。  
   - 方法：可用性访谈 + 任务完成时间。

3. 动画干扰度评估
   - 指标：用户是否觉得 Markie 动画「可爱但不打扰」，避免过多动态造成注意力分散。  
   - 方法：Likert 量表调查（1–5 分），目标是平均 ≥ 4 分。

---

## 6. 低保真原型图（Lo-Fi Wireframes）

> 以下为 ASCII 低保真原型图，目的是帮助对齐信息结构和交互节奏，视觉细节由设计进一步输出。

### 6.1 画布 + 边栏同步布局（桌面端工作视图）

```text
+----------------------------------------------------------------------------------+
| 顶部导航 / Header                                                                |
|----------------------------------------------------------------------------------|
|  工具栏 / Tab: [Report] [Launch Pack] [Canvas]                                   |
|----------------------------------------------------------------------------------|
|  Research Canvas 工作区                                      | Markie 边栏（320px）|
|--------------------------------------------------------------|---------------------|
|  - 节点 / 连线                                               |  头像 + 状态条      |
|  - 拖拽编辑                                                   |---------------------|
|  - 放大 / 缩小                                               |  对话区             |
|                                                              |   - 用户气泡        |
|                                                              |   - Markie 回复     |
|                                                              |---------------------|
|                                                              |  快捷指令区         |
|                                                              |   [竞品调研]        |
|                                                              |   [评论分析]        |
|                                                              |   [生成脚本]        |
|                                                              |---------------------|
|                                                              |  动画展示区         |
|                                                              |   (任务状态动画)    |
+--------------------------------------------------------------+---------------------+
```

### 6.2 无限画布视图（节点细节）

```text
+----------------------------------------------------------------------------------+
| Research Canvas                                                                  |
|----------------------------------------------------------------------------------|
|  工具栏: [选择] [拖拽] [缩放] [对齐] [导出]                                      |
|----------------------------------------------------------------------------------|
|                                                                                  |
|   [起点节点]                                                                     |
|      "调研目标: 提升消消乐类游戏开玩率"                                         |
|         |                                                                        |
|         v                                                                        |
|   [节点1: 竞品广告策略]    --->   [节点2: 用户评论洞察]                           |
|       (来自 analyzeCompetitor)        (来自 analyzeComments)                    |
|         |                                       |                                |
|         v                                       v                                |
|   [节点3: 差异化策略]       --->   [节点4: 创意生成方案]                          |
|       (Insights Report)            (generateCreativeAssets)                     |
|                                                                                  |
|                    \                                                            |
|                     \                                                           |
|                      v                                                          |
|                 [节点5: 实验配置]                                               |
|                 (ExperimentPack 概览)                                           |
|                                                                                  |
+----------------------------------------------------------------------------------+
```

### 6.3 Markie 状态与动画示意

```text
+------------------------+
|  Markie 头像区域       |
|------------------------|
|  [^_^]  Idle           |
|  [o_o]  Listening      |
|  [¬_¬] Thinking        |
|  [^o^] Success         |
|  [>_<] Error           |
+------------------------+

交互示例：
- 用户输入问题时，头像区域从 [^_^] → [o_o]，底部出现“输入中...” 提示。
- 调用任务中，头像变为 [¬_¬]，右侧显示小圆点跳动动画。
- 任务成功，头像变为 [^o^]，出现小星星闪烁 1 秒。
```

---

## 7. 交付物

1. 交互 & 视觉
   - Markie 角色设定与表情状态图。  
   - 边栏布局与画布界面的高保真视觉稿。  
   - 动画规范文档（包含状态机与触发条件）。

2. 前端
   - 右侧边栏组件（含折叠 / 展开逻辑）。  
   - Research Canvas 页面与节点编辑能力。  
   - 与现有 Engines / Store 的集成（自动生成节点）。

3. 后端 / 服务（视版本范围而定）
   - AI Assistant Service 接口定义与 Mock 实现。  
   - Canvas 数据模型与持久化 API（如在本期纳入）。

4. 数据与实验
   - Telemetry 埋点方案（边栏打开率、画布使用、节点数量等）。  
   - 与现有指标（Qualified Start Rate、TTFV）联动的实验设计文档。

   补充：先明确理念：canva现在mvp版本不用拖拽，先做演示就好，现有「一键」能力也不需要拆成更多快捷指令
